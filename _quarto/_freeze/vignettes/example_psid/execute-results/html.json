{
  "hash": "b730c91ea2809f199f8cd21920857dc1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Individual-level Child Penalties with PSID\"\nauthor: Kazuharu Yanagimoto\ndate: today\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(unitdid)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(purrr)\n```\n:::\n\n\n\n\n### Panel Study of Income Dynamics (PSID)\n\nThe PSID data is a longitudinal household survey of the United States and one of\nthe longest and most famous panel surveys in the world. The study began in 1968\nwith a nationally representative sample of over 18,000 individuals living in\n5,000 families. The data is available [here](https://psidonline.isr.umich.edu)\nfor the registered users.\n\nTo avoid the convoluted cleaning tasks, I mostly use the cleaning codes provided\nby the [Comparative Panel File (CPF)](https://www.cpfdata.com). Their cleaning\n[codes](https://www.cpfdata.com) are developed for creating a harmonized panel\ndata from seven countries (Australia, Germany, the UK, South Korea, Russia,\nSwitzerland, and the US).\n\nTo replicate this article, you need to run\n\n1.  Run the code of the CPF only for the PSID\n    -   In step 4 (Add vars constant across all waves) of the\n        `CPF-Code/03_PSID/us_01_3_GEt_vars.do`, add `ER32024` (birth year of the\n        first child)\n    -   `us_01.dta`-`us_03.dta` will be produced\n2.  Run the following code to create a dataset for the child penalties\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(haven)\ncpf_us01 <- read_dta(here::here(\"vignettes/us_01.dta\"))\ncpf_us03 <- read_dta(here::here(\"vignettes/us_03_CPF.dta\"))\n\never_birth <- cpf_us01 |>\n  select(pid, cyear = ER32024) |>\n  filter(cyear != 9999) |>\n  distinct()\n\ncp_psid <- cpf_us03 |>\n  filter(country == 3) |>\n  select(id = pid,\n         year = intyear,\n         byear = yborn,\n         gender = female,\n         earn = incjobs_yg,\n         hours = whweek,\n         years_edu = eduy) |>\n  mutate(gender = if_else(gender == 0, \"Men\", \"Women\"),\n         particip = if_else(hours > 0, 1, 0),\n         wage = if_else(particip == 1, earn / hours, 0),\n         years_edu = if_else(years_edu < 0, NA_integer_, years_edu)) |>\n  right_join(ever_birth, by = c(\"id\" = \"pid\")) |>\n  mutate(rel_time = year - cyear) |>\n  filter(!is.na(earn))\n\nsave(cp_psid, file = here::here(\"vignettes/cp_psid.rds\"))\n```\n:::\n\n\n\n\n## Analysis of Child Penalties on Participation\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(here::here(\"vignettes/cp_psid.rds\"))\n\ncp_psid <- cp_psid |>\n  mutate(eage = cyear - byear) |>\n  filter(cyear >= 1968,\n         year <= 1997, # The last year of the annual data\n         between(eage, 22, 40))\n\nmdl_particip <- cp_psid |>\n  unitdid(yname = \"particip\",\n        iname = \"id\",\n        tname = \"year\",\n        ename = \"cyear\",\n        bname = \"byear\",\n        by = c(\"gender\"),\n        compute_varcov = \"var\")\n\nsum_particip <- summary(mdl_particip, agg = \"event_age\") |>\n  filter(between(event_age, 26, 32))\n\ndf_plot <- sum_particip |>\n  filter(rel_time == 0) |>\n  mutate(rel_time = -1, mean = 0,\n         var = 0) |>\n  bind_rows(sum_particip) |>\n  mutate(lbl_facet = paste0(\"Age \", event_age))\n```\n:::\n\n\n\n\n### Mean of Child Penalties on Participation\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndf_plot |>\n  ggplot(aes(x = rel_time, y = mean,\n             color = gender, shape = gender)) +\n  geom_point() +\n  geom_line() +\n  geom_vline(xintercept = -1, linetype = \"dashed\") +\n  geom_hline(yintercept = 0) +\n  facet_wrap(~lbl_facet) +\n  scale_color_manual(values = c(\"#009F8C\", \"#B75C9D\")) +\n  labs(x = \"Time to First Childbirth\",\n       y = NULL,\n       color = NULL, shape = NULL) +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank(),\n        panel.grid.major.x = element_blank(),\n        legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](example_psid_files/figure-html/mean_cage-1.svg){width=672}\n:::\n:::\n\n\n\n\n### Standard Deviation of Child Penalties on Participation\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndf_plot |>\n  ggplot(aes(x = rel_time, y = sqrt(var),\n             color = gender, shape = gender)) +\n  geom_point() +\n  geom_line() +\n  geom_vline(xintercept = -1, linetype = \"dashed\") +\n  geom_hline(yintercept = 0) +\n  facet_wrap(~lbl_facet) +\n  scale_color_manual(values = c(\"#009F8C\", \"#B75C9D\")) +\n  labs(x = \"Time to First Childbirth\",\n       y = NULL, color = NULL, shape = NULL) +\n  theme_minimal() +\n  theme(panel.grid.minor = element_blank(),\n        panel.grid.major.x = element_blank(),\n        legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](example_psid_files/figure-html/sd_cage-1.svg){width=672}\n:::\n:::\n\n\n\n\n\n## Scatter Plot with Covariates\n\nTo highlight the flexibility of the individual child penalties, let's plot the\nrelationship between the years of education and the child penalties.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunitdid_particip <- get_unitdid(mdl_particip)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(patchwork)\n\nplot_scatter <- function(gender) {\n  clr <- ifelse(gender == \"Men\", \"#009F8C\", \"#B75C9D\")\n\n  unitdid_particip |>\n    filter(gender == {{gender}}, between(rel_time, 0, 5)) |>\n    mutate(lbl_facet = paste0(\"k = \", rel_time)) |>\n    ggplot(aes(x = years_edu, y = particip_tilde)) +\n    geom_point(color = clr, alpha = 0.1) +\n    geom_smooth(method = \"lm\", color = clr, fill = clr) +\n    facet_wrap(~lbl_facet, nrow = 1) +\n    labs(x = \"Years of Education\",\n         y = \"CP on Participation\",\n         title = gender) +\n    coord_cartesian(xlim = c(6, NA), ylim = c(-1.25, 0.5)) +\n    theme_minimal()\n}\n\np1 <- plot_scatter(\"Men\")\np2 <- plot_scatter(\"Women\")\n\np1 / p2\n```\n\n::: {.cell-output-display}\n![](example_psid_files/figure-html/unnamed-chunk-3-1.svg){width=672}\n:::\n:::\n\n\n\n\n### On Binscatter\n\nAnother way to visualize the relationship is to use the binscatter [@cattaneo2024].\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(binsreg)\n\ncompute_binsreg <- function(gender) {\n  est <- unitdid_particip |>\n    filter(gender == {{ gender }}) |>\n    as.data.frame() |>\n    binsreg(x = years_edu, y = particip_tilde,\n            data = _, by = rel_time)\n\n  map(0:5, ~{est$data.plot[[paste0(\"Group \", .x)]]$data.dots |>\n               select(x, fit) |>\n               mutate(rel_time = .x)}) |>\n    list_rbind() |>\n    mutate(gender = gender)\n}\n\nbs <- map(c(\"Men\", \"Women\"), compute_binsreg) |> list_rbind()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nplot_binsreg <- function(gender) {\n  clr <- ifelse(gender == \"Men\", \"#009F8C\", \"#B75C9D\")\n\n  bs |>\n    filter(gender == {{ gender }}) |>\n    mutate(lbl_facet = paste0(\"k = \", rel_time)) |>\n    ggplot(aes(x = x, y = fit)) +\n    geom_point(color = clr) +\n    facet_wrap(~lbl_facet, nrow = 1) +\n    labs(x = \"Years of Education\",\n         y = \"CP on Participation\",\n         title = gender) +\n    theme_minimal()\n}\n\np1 <- plot_binsreg(\"Men\")\np2 <- plot_binsreg(\"Women\")\n\np1 / p2\n```\n\n::: {.cell-output-display}\n![](example_psid_files/figure-html/unnamed-chunk-6-1.svg){width=672}\n:::\n:::\n\n\n\n\n## References\n\n::: {#refs}\n:::",
    "supporting": [
      "example_psid_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}